<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Troop Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { margin: 0; background: #111; font-family: sans-serif; color: white; }
    .blur-bg {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-size: cover; background-position: center;
      filter: blur(20px); opacity: 0.3; z-index: -1;
    }
    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(0, 0, 0, 0.6); padding: 10px 15px;
      position: sticky; top: 0; z-index: 1000;
    }
    .top-bar button {
      background: rgba(255,255,255,0.1); color: white;
      border: none; padding: 6px 12px; border-radius: 4px;
      font-size: 14px; cursor: pointer;
    }
    .video-wrapper { position: relative; background: black; }
    video { width: 100%; height: auto; }
    .controls {
      position: relative; background: rgba(0, 0, 0, 0.6);
      display: flex; flex-direction: column; padding: 8px 12px;
    }
    .progress-container {
      position: relative;
      height: 6px; width: 100%; background: #444;
      border-radius: 3px; cursor: pointer;
    }
    .progress-bar {
      height: 6px; background: #1e88e5;
      border-radius: 3px; width: 0%;
    }
    .progress-knob {
      position: absolute;
      top: -5px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transform: translateX(-50%);
      pointer-events: auto;
      cursor: grab;
    }
    .tooltip {
      position: absolute; bottom: 100%; transform: translateX(-50%);
      font-size: 11px; background: #000; color: #fff;
      padding: 2px 6px; border-radius: 3px; white-space: nowrap;
      display: none;
    }
    .control-row {
      display: flex; justify-content: space-between; align-items: center; margin-top: 10px;
    }
    .control-left, .control-right {
      display: flex; align-items: center; gap: 12px;
    }
    .controls img {
      width: 24px; height: 24px; filter: brightness(0) invert(1); cursor: pointer;
    }
    .time-display {
      margin-top: 8px; font-size: 14px;
    }
    .info {
      padding: 15px;
    }
    .info h2 { margin: 8px 0; }
    .info .meta { font-size: 13px; color: #ccc; }
    .info p { margin-top: 10px; line-height: 1.4; }
    .share-btn {
      background: #1e88e5; border: none; color: white;
      padding: 8px 14px; border-radius: 5px;
      font-size: 14px; margin-top: 12px; cursor: pointer;
    }
  </style>
</head>
<body>

<div class="blur-bg" id="bgPoster"></div>

<div class="top-bar">
  <button onclick="history.back()">‚¨Ö Back</button>
  <div id="movieTitle">Now Playing</div>
  <button onclick="location.href='index.html'">üè† Home</button>
</div>

<div class="video-wrapper">
  <video id="player" poster="" preload="metadata">
    <source id="videoSource" src="" type="video/mp4" />
  </video>

  <div class="controls">
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-knob" id="progressKnob"></div>
      <div class="tooltip" id="tooltip"></div>
    </div>
    <div class="control-row">
      <div class="control-left">
        <img src="https://cdn-icons-png.flaticon.com/512/565/565242.png" alt="Back 10s" onclick="skip(-10)">
        <img id="playBtn" src="https://cdn-icons-png.flaticon.com/512/2088/2088569.png" alt="Play" onclick="togglePlay()">
      </div>
      <div class="control-right">
        <img src="https://cdn-icons-png.flaticon.com/512/565/565239.png" alt="Forward 10s" onclick="skip(10)">
        <img id="volumeBtn" src="https://cdn-icons-png.flaticon.com/512/565/565296.png" alt="Volume" onclick="toggleMute()">
        <img id="fullscreenBtn" src="https://cdn-icons-png.flaticon.com/512/3354/3354155.png" alt="Fullscreen" onclick="toggleFullscreen()">
      </div>
    </div>
    <div class="time-display">
      <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
    </div>
  </div>
</div>

<div class="info">
  <h2 id="titleText">Title</h2>
  <div class="meta" id="metaText">Year ¬∑ Type</div>
  <p id="descText">Description not available.</p>
  <div><strong>Cast:</strong> <span id="castText">N/A</span></div>
  <button class="share-btn" onclick="copyLink()">üîó Share This</button>
</div>

<script>
const $ = id => document.getElementById(id);
const player = $("player");
const p = new URLSearchParams(location.search);
const url = decodeURIComponent(p.get("url") || "");
const title = decodeURIComponent(p.get("title") || "Unknown Title");
const desc = decodeURIComponent(p.get("desc") || "No description.");
const cast = decodeURIComponent(p.get("cast") || "Unknown");
const year = decodeURIComponent(p.get("year") || "");
const type = decodeURIComponent(p.get("type") || "");
const poster = decodeURIComponent(p.get("poster") || "");

$("videoSource").src = url;
$("titleText").innerText = title;
$("movieTitle").innerText = title;
$("metaText").innerText = `${year} ¬∑ ${type}`;
$("descText").innerText = desc;
$("castText").innerText = cast;
$("bgPoster").style.backgroundImage = `url('${poster}')`;
player.poster = poster;

const playBtn = $("playBtn"), volumeBtn = $("volumeBtn"), fullscreenBtn = $("fullscreenBtn");
const progressBar = $("progressBar"), tooltip = $("tooltip");
const knob = $("progressKnob"), progressContainer = $("progressContainer");
const currentTimeDisplay = $("currentTime"), totalTimeDisplay = $("totalTime");

const storageKey = "player_" + btoa(url);
player.currentTime = parseFloat(localStorage.getItem(storageKey)) || 0;

function formatTime(t) {
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60).toString().padStart(2, "0");
  return `${m}:${s}`;
}

function togglePlay() {
  if (player.paused) {
    player.play();
    playBtn.src = "https://cdn-icons-png.flaticon.com/512/1214/1214679.png";
  } else {
    player.pause();
    playBtn.src = "https://cdn-icons-png.flaticon.com/512/2088/2088569.png";
  }
}

function toggleMute() {
  player.muted = !player.muted;
  volumeBtn.src = player.muted
    ? "https://cdn-icons-png.flaticon.com/512/4546/4546899.png"
    : "https://cdn-icons-png.flaticon.com/512/565/565296.png";
}

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    player.requestFullscreen();
    fullscreenBtn.src = "https://cdn-icons-png.flaticon.com/512/3502/3502504.png";
  } else {
    document.exitFullscreen();
    fullscreenBtn.src = "https://cdn-icons-png.flaticon.com/512/3354/3354155.png";
  }
}

function skip(sec) {
  player.currentTime += sec;
}

function updateUI() {
  const percent = (player.currentTime / player.duration) * 100;
  progressBar.style.width = percent + "%";
  knob.style.left = percent + "%";
  currentTimeDisplay.innerText = formatTime(player.currentTime);
  localStorage.setItem(storageKey, player.currentTime);
}

player.addEventListener("timeupdate", updateUI);
player.addEventListener("loadedmetadata", () => {
  totalTimeDisplay.innerText = formatTime(player.duration);
});
player.addEventListener("ended", () => {
  playBtn.src = "https://cdn-icons-png.flaticon.com/512/2088/2088569.png";
});

progressContainer.addEventListener("click", e => {
  const rect = progressContainer.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  player.currentTime = percent * player.duration;
});

progressContainer.addEventListener("mousemove", e => {
  const rect = progressContainer.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  tooltip.innerText = formatTime(percent * player.duration);
  tooltip.style.left = `${e.clientX - rect.left}px`;
  tooltip.style.display = "block";
});

progressContainer.addEventListener("mouseleave", () => {
  tooltip.style.display = "none";
});

let dragging = false;

knob.addEventListener("mousedown", () => dragging = true);
document.addEventListener("mouseup", () => dragging = false);
document.addEventListener("mousemove", e => {
  if (!dragging) return;
  const rect = progressContainer.getBoundingClientRect();
  const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  player.currentTime = percent * player.duration;
});

function copyLink() {
  navigator.clipboard.writeText(location.href).then(() => alert("üîó Link copied!"));
}
</script>

</body>
</html>
