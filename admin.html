<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header style="padding: 10px;">
    <button onclick="window.location.href='index.html'" style="background:#444; color:white; padding:6px 12px; border:none; border-radius:6px;">‚Üê Back to Home</button>
  </header>

  <div class="container">
    <h1>Admin Panel</h1>

    <input type="text" id="searchTitle" placeholder="Search Movie Title" />
    <button onclick="searchTMDb()">Search TMDb</button>
    
    <label>Select Result</label>
    <select id="searchResults" onchange="fillMovieFields()"></select>

    <input type="text" id="poster" placeholder="Poster" />
    <input type="text" id="title" placeholder="Title" />
    <input type="text" id="year" placeholder="Year" />
    <input type="text" id="type" placeholder="Type" />
    <input type="text" id="videoUrl" placeholder="Video URL" />

    <button onclick="addMovie()">Add / Update Movie</button>

    <h2>üìÅ Preview Added Movies:</h2>
    <div id="preview"></div>
  </div>

  <script>
    const API_KEY = "e2d4d607b8c4d17dc47e61cc00b48837"; // Replace with your actual TMDb key
    let movieData = [];

    function searchTMDb() {
      const query = document.getElementById("searchTitle").value;
      fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          movieData = data.results;
          const select = document.getElementById("searchResults");
          select.innerHTML = movieData.map((m, i) => `<option value="${i}">${m.title}</option>`).join("");
        });
    }

    function fillMovieFields() {
      const index = document.getElementById("searchResults").value;
      const selected = movieData[index];
      document.getElementById("poster").value = "https://image.tmdb.org/t/p/w500" + selected.poster_path;
      document.getElementById("title").value = selected.title;
      document.getElementById("year").value = (selected.release_date || "").split("-")[0];
      document.getElementById("type").value = "movie";
    }

    function addMovie() {
      const movie = {
        title: document.getElementById("title").value,
        year: document.getElementById("year").value,
        type: document.getElementById("type").value,
        poster: document.getElementById("poster").value,
        videoUrl: document.getElementById("videoUrl").value
      };

      const movies = JSON.parse(localStorage.getItem("movies") || "[]");
      const exists = movies.findIndex(m => m.title === movie.title);
      if (exists !== -1) {
        movies[exists] = movie;
      } else {
        movies.push(movie);
      }

      localStorage.setItem("movies", JSON.stringify(movies));
      showPreview();
    }

    function showPreview() {
      const preview = document.getElementById("preview");
      const movies = JSON.parse(localStorage.getItem("movies") || "[]");
      preview.innerHTML = movies.map(m => `
        <div style="margin:10px 0">
          <img src="${m.poster}" height="80"><br>
          <b>${m.title}</b> (${m.year})<br>
          <small>${m.type}</small>
        </div>
      `).join("");
    }

    showPreview();
  </script>
</body>
</html>
