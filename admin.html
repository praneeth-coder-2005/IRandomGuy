<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { background: #121212; color: #fff; font-family: Arial; padding: 20px; }
    input, select {
      width: 100%; padding: 10px; background: #1e1e1e; border: none; color: white; border-radius: 5px;
      margin-top: 5px;
    }
    label { margin-top: 10px; display: block; }
    button {
      width: 100%; background: #1e88e5; padding: 10px; margin-top: 15px;
      border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer;
    }
    .preview-grid {
      margin-top: 30px; display: flex; gap: 12px; flex-wrap: wrap;
    }
    .card {
      background: #1c1c1c; padding: 10px; border-radius: 6px; width: 140px; text-align: center;
    }
    .card img { width: 100%; border-radius: 5px; }
    .card a { color: white; text-decoration: none; }
  </style>
</head>
<body>

<script>
  if (localStorage.getItem("admin_login") !== "true") {
    location.href = "login.html";
  }
</script>

<h1>Troop Admin Panel</h1>
<label>Search Title (TMDB)</label>
<input type="text" id="searchText" />
<button onclick="searchTMDB()">Search TMDB</button>

<label>Choose Result:</label>
<select id="tmdbResults"><option value="">-- Select movie --</option></select>

<label>Poster URL</label><input type="text" id="poster" readonly />
<label>Title</label><input type="text" id="title" readonly />
<label>Year</label><input type="text" id="year" readonly />
<label>Tag</label><input type="text" id="tag" />
<label>Video URL</label><input type="text" id="video" />
<button onclick="addMovie()">Add Movie</button>

<div class="preview-grid" id="preview"></div>

<script>
  const TMDB_KEY = 'YOUR_TMDB_API_KEY'; // Replace with your TMDB API key
  const sel = document.getElementById("tmdbResults");

  async function searchTMDB() {
    const q = document.getElementById("searchText").value.trim();
    const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_KEY}&query=${q}`);
    const j = await res.json();
    sel.innerHTML = `<option value="">-- Select --</option>`;
    j.results.forEach(r => {
      sel.innerHTML += `<option value="${r.id}|${r.media_type}">${r.title||r.name}</option>`;
    });
  }

  sel.onchange = async () => {
    const [id, type] = sel.value.split('|');
    const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}`);
    const j = await res.json();
    poster.value = `https://image.tmdb.org/t/p/w500${j.poster_path}`;
    title.value = j.title || j.name;
    year.value = (j.release_date || j.first_air_date || '').slice(0,4);
    tag.value = type.toUpperCase();
  }

  function loadMovies() {
    const data = JSON.parse(localStorage.getItem("troop_movies") || "[]");
    const preview = document.getElementById("preview");
    preview.innerHTML = '';
    data.forEach(m => {
      preview.innerHTML += `
        <div class="card">
          <a href="player.html?video=${encodeURIComponent(m.video)}">
            <img src="${m.poster}" />
            <div>${m.title}</div><div>${m.year}</div>
          </a>
        </div>`;
    });
  }

  function addMovie() {
    const movie = {
      poster: poster.value,
      title: title.value,
      year: year.value,
      tag: tag.value,
      video: video.value
    };
    const arr = JSON.parse(localStorage.getItem("troop_movies") || "[]");
    arr.push(movie);
    localStorage.setItem("troop_movies", JSON.stringify(arr));
    loadMovies();
    alert("Movie added!");
  }

  window.onload = loadMovies;
</script>
</body>
</html>
